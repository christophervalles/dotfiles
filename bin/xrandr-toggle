#!/bin/bash
intern=$(xrandr | grep eDP | awk '{print $1}')
extern=$(xrandr | grep -e " connected" | awk '{print $1}' | grep -v "$intern")

echo "Utility called" | systemd-cat -t xrandr-toggle -p debug

if xrandr | grep "$intern connected primary"; then
    cmd=''
    for m in $extern; do
      if [ -z "$cmd" ]; then
        cmd="xrandr --output $m --auto --primary"
      else
        cmd="$cmd --output $m --auto --left-of $previous"
      fi

      previous=$m
    done

    if [ -z "$cmd"]; then
      echo "No external screens connected" | systemd-cat -t xrandr-toggle -p warning
      exit 1
    fi

    echo "Running command: $cmd" | systemd-cat -t xrandr-toggle -p info
    eval $cmd

    echo "Disabling $intern" | systemd-cat -t xrandr-toggle -p info
    xrandr --output "$intern" --off
else
    for m in $extern; do
      echo "Disabling $m" | systemd-cat -t xrandr-toggle -p info
      xrandr --output "$m" --off
    done

    echo "Enabling $intern" | systemd-cat -t xrand-toggle -p info
    xrandr --output "$intern" --auto --primary
fi

exit 0
